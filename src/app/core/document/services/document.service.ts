import { Injectable } from '@angular/core';
import * as FileSaver from 'file-saver';
import * as JSZip from 'jszip';
import { Observable, of } from 'rxjs';

interface Document {
  request: string;
  response: string;
}

@Injectable({
  providedIn: 'root',
})
export class DocumentService {
  // Este es el mock de datos
  private mockDocuments: Document[] = [
    {
      request:
        '<Root><InitialContract><Persons><Person><AdditionalRole value=""/><Customer_Number value=""/><DOB value="1996-12-23"/><Driver value=""/><IDPerson value="528c330f-d9d2-11e9-b29b-0a5801e1786a"/><Owner value="BS"/><licensedate value=""/></Person></Persons><Objects><Vehicle><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><LicensePlateNumber value="LP12340001"/><VCubic value="1368"/><VPrice value="25400"/><VSeats value="4"/><VYear value="2009"/><VehicleType value="KFZP10"/><VehicleUsage value="WF003"/></Vehicle></Objects><Coverages><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d5a21d-26d2-11ee-85b2-12a908982d0d"/></Coverage><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d6174e-26d2-11ee-85b2-12a908982d0d"/></Coverage><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d6656f-26d2-11ee-85b2-12a908982d0d"/></Coverage><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d66570-26d2-11ee-85b2-12a908982d0d"/></Coverage><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d68c81-26d2-11ee-85b2-12a908982d0d"/></Coverage></Coverages><Agent value="0000001"/><ExpiryDate value="2024-07-20"/><Pollfnr value="8000997371"/><ProposalNumber value=""/><QuoteStartDate value=""/><UserId value=""/><ValidFromDate value="2023-07-20"/></InitialContract><Offer><Persons><Person><AdditionalRole value=""/><Customer_Number value=""/><DOB value="1996-12-23"/><Driver value=""/><IDPerson value="528c330f-d9d2-11e9-b29b-0a5801e1786a"/><Owner value="BS"/><licensedate value=""/></Person></Persons><Objects><Vehicle><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><LicensePlateNumber value="LP12340001"/><VCubic value="1368"/><VPrice value="25400"/><VSeats value="4"/><VYear value="2009"/><VehicleType value="KFZP10"/><VehicleUsage value="WF003"/></Vehicle></Objects><Coverages><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d5a21d-26d2-11ee-85b2-12a908982d0d"/></Coverage><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d6174e-26d2-11ee-85b2-12a908982d0d"/></Coverage><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d6656f-26d2-11ee-85b2-12a908982d0d"/></Coverage><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d66570-26d2-11ee-85b2-12a908982d0d"/></Coverage><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d68c81-26d2-11ee-85b2-12a908982d0d"/></Coverage></Coverages><Agent value="0000001"/><ExpiryDate value="2024-07-20"/><Pollfnr value="8000997371"/><ProposalNumber value=""/><QuoteStartDate value=""/><UserId value=""/><ValidFromDate value="2023-07-20"/></Offer></Root>',
      response:
        '<?xml version="1.0" encoding="utf-16"?><root><Offer><Coverages><Coverage><VERSV value="08d5a21d-26d2-11ee-85b2-12a908982d0d" /><LPPRM value="510" /><MAPRM value="95" /><MODPRM value="304.8" /><MTPLPRM value="56" /><PAPRM value="392" /></Coverage><Coverage><VERSV value="08d6174e-26d2-11ee-85b2-12a908982d0d" /><LPPRM value="510" /><MAPRM value="95" /><MODPRM value="304.8" /><MTPLPRM value="56" /><PAPRM value="392" /></Coverage><Coverage><VERSV value="08d6656f-26d2-11ee-85b2-12a908982d0d" /><LPPRM value="510" /><MAPRM value="95" /><MODPRM value="304.8" /><MTPLPRM value="56" /><PAPRM value="392" /></Coverage><Coverage><VERSV value="08d66570-26d2-11ee-85b2-12a908982d0d" /><LPPRM value="510" /><MAPRM value="95" /><MODPRM value="304.8" /><MTPLPRM value="56" /><PAPRM value="392" /></Coverage><Coverage><VERSV value="08d68c81-26d2-11ee-85b2-12a908982d0d" /><LPPRM value="510" /><MAPRM value="95" /><MODPRM value="304.8" /><MTPLPRM value="56" /><PAPRM value="392" /></Coverage></Coverages><Objects><Vehicle><VehicleID value="df0933fe-408a-11ed-a7cf-0a5801e1e47d" /></Vehicle><Vehicle><VehicleID value="df0933fe-408a-11ed-a7cf-0a5801e1e47d" /></Vehicle><Vehicle><VehicleID value="df0933fe-408a-11ed-a7cf-0a5801e1e47d" /></Vehicle><Vehicle><VehicleID value="df0933fe-408a-11ed-a7cf-0a5801e1e47d" /></Vehicle><Vehicle><VehicleID value="df0933fe-408a-11ed-a7cf-0a5801e1e47d" /></Vehicle></Objects></Offer></root>',
    },
    {
      request:
        '<Root><InitialContract><Persons><Person><AdditionalRole value=""/><Customer_Number value=""/><DOB value="1996-12-23"/><Driver value=""/><IDPerson value="528c330f-d9d2-11e9-b29b-0a5801e1786a"/><Owner value="BS"/><licensedate value=""/></Person></Persons><Objects><Vehicle><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><LicensePlateNumber value="LP12340001"/><VCubic value="1368"/><VPrice value="25400"/><VSeats value="4"/><VYear value="2009"/><VehicleType value="KFZP10"/><VehicleUsage value="WF003"/></Vehicle></Objects><Coverages><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d5a21d-26d2-11ee-85b2-12a908982d0d"/></Coverage><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d6174e-26d2-11ee-85b2-12a908982d0d"/></Coverage><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d6656f-26d2-11ee-85b2-12a908982d0d"/></Coverage><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d66570-26d2-11ee-85b2-12a908982d0d"/></Coverage><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d68c81-26d2-11ee-85b2-12a908982d0d"/></Coverage></Coverages><Agent value="0000001"/><ExpiryDate value="2024-07-20"/><Pollfnr value="8000997371"/><ProposalNumber value=""/><QuoteStartDate value=""/><UserId value=""/><ValidFromDate value="2023-07-20"/></InitialContract><Offer><Persons><Person><AdditionalRole value=""/><Customer_Number value=""/><DOB value="1996-12-23"/><Driver value=""/><IDPerson value="528c330f-d9d2-11e9-b29b-0a5801e1786a"/><Owner value="BS"/><licensedate value=""/></Person></Persons><Objects><Vehicle><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><LicensePlateNumber value="LP12340001"/><VCubic value="1368"/><VPrice value="25400"/><VSeats value="4"/><VYear value="2009"/><VehicleType value="KFZP10"/><VehicleUsage value="WF003"/></Vehicle></Objects><Coverages><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d5a21d-26d2-11ee-85b2-12a908982d0d"/></Coverage><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d6174e-26d2-11ee-85b2-12a908982d0d"/></Coverage><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d6656f-26d2-11ee-85b2-12a908982d0d"/></Coverage><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d66570-26d2-11ee-85b2-12a908982d0d"/></Coverage><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d68c81-26d2-11ee-85b2-12a908982d0d"/></Coverage></Coverages><Agent value="0000001"/><ExpiryDate value="2024-07-20"/><Pollfnr value="8000997371"/><ProposalNumber value=""/><QuoteStartDate value=""/><UserId value=""/><ValidFromDate value="2023-07-20"/></Offer></Root>',
      response:
        '<?xml version="1.0" encoding="utf-16"?><root><Offer><Coverages><Coverage><VERSV value="08d5a21d-26d2-11ee-85b2-12a908982d0d" /><LPPRM value="510" /><MAPRM value="95" /><MODPRM value="304.8" /><MTPLPRM value="56" /><PAPRM value="392" /></Coverage><Coverage><VERSV value="08d6174e-26d2-11ee-85b2-12a908982d0d" /><LPPRM value="510" /><MAPRM value="95" /><MODPRM value="304.8" /><MTPLPRM value="56" /><PAPRM value="392" /></Coverage><Coverage><VERSV value="08d6656f-26d2-11ee-85b2-12a908982d0d" /><LPPRM value="510" /><MAPRM value="95" /><MODPRM value="304.8" /><MTPLPRM value="56" /><PAPRM value="392" /></Coverage><Coverage><VERSV value="08d66570-26d2-11ee-85b2-12a908982d0d" /><LPPRM value="510" /><MAPRM value="95" /><MODPRM value="304.8" /><MTPLPRM value="56" /><PAPRM value="392" /></Coverage><Coverage><VERSV value="08d68c81-26d2-11ee-85b2-12a908982d0d" /><LPPRM value="510" /><MAPRM value="95" /><MODPRM value="304.8" /><MTPLPRM value="56" /><PAPRM value="392" /></Coverage></Coverages><Objects><Vehicle><VehicleID value="df0933fe-408a-11ed-a7cf-0a5801e1e47d" /></Vehicle><Vehicle><VehicleID value="df0933fe-408a-11ed-a7cf-0a5801e1e47d" /></Vehicle><Vehicle><VehicleID value="df0933fe-408a-11ed-a7cf-0a5801e1e47d" /></Vehicle><Vehicle><VehicleID value="df0933fe-408a-11ed-a7cf-0a5801e1e47d" /></Vehicle><Vehicle><VehicleID value="df0933fe-408a-11ed-a7cf-0a5801e1e47d" /></Vehicle></Objects></Offer></root>',
    },
    {
      request:
        '<Root><InitialContract><Persons><Person><AdditionalRole value=""/><Customer_Number value=""/><DOB value="1996-12-23"/><Driver value=""/><IDPerson value="528c330f-d9d2-11e9-b29b-0a5801e1786a"/><Owner value="BS"/><licensedate value=""/></Person></Persons><Objects><Vehicle><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><LicensePlateNumber value="LP12340001"/><VCubic value="1368"/><VPrice value="25400"/><VSeats value="4"/><VYear value="2009"/><VehicleType value="KFZP10"/><VehicleUsage value="WF003"/></Vehicle></Objects><Coverages><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d5a21d-26d2-11ee-85b2-12a908982d0d"/></Coverage><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d6174e-26d2-11ee-85b2-12a908982d0d"/></Coverage><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d6656f-26d2-11ee-85b2-12a908982d0d"/></Coverage><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d66570-26d2-11ee-85b2-12a908982d0d"/></Coverage><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d68c81-26d2-11ee-85b2-12a908982d0d"/></Coverage></Coverages><Agent value="0000001"/><ExpiryDate value="2024-07-20"/><Pollfnr value="8000997371"/><ProposalNumber value=""/><QuoteStartDate value=""/><UserId value=""/><ValidFromDate value="2023-07-20"/></InitialContract><Offer><Persons><Person><AdditionalRole value=""/><Customer_Number value=""/><DOB value="1996-12-23"/><Driver value=""/><IDPerson value="528c330f-d9d2-11e9-b29b-0a5801e1786a"/><Owner value="BS"/><licensedate value=""/></Person></Persons><Objects><Vehicle><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><LicensePlateNumber value="LP12340001"/><VCubic value="1368"/><VPrice value="25400"/><VSeats value="4"/><VYear value="2009"/><VehicleType value="KFZP10"/><VehicleUsage value="WF003"/></Vehicle></Objects><Coverages><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d5a21d-26d2-11ee-85b2-12a908982d0d"/></Coverage><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d6174e-26d2-11ee-85b2-12a908982d0d"/></Coverage><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d6656f-26d2-11ee-85b2-12a908982d0d"/></Coverage><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d66570-26d2-11ee-85b2-12a908982d0d"/></Coverage><Coverage><Instances></Instances><Driver_Un25 value=""/><Driver_Un25c value=""/><IDVehicle value="df0933fe-408a-11ed-a7cf-0a5801e1e47d"/><Versv value="08d68c81-26d2-11ee-85b2-12a908982d0d"/></Coverage></Coverages><Agent value="0000001"/><ExpiryDate value="2024-07-20"/><Pollfnr value="8000997371"/><ProposalNumber value=""/><QuoteStartDate value=""/><UserId value=""/><ValidFromDate value="2023-07-20"/></Offer></Root>',
      response:
        '<?xml version="1.0" encoding="utf-16"?><root><Offer><Coverages><Coverage><VERSV value="08d5a21d-26d2-11ee-85b2-12a908982d0d" /><LPPRM value="510" /><MAPRM value="95" /><MODPRM value="304.8" /><MTPLPRM value="56" /><PAPRM value="392" /></Coverage><Coverage><VERSV value="08d6174e-26d2-11ee-85b2-12a908982d0d" /><LPPRM value="510" /><MAPRM value="95" /><MODPRM value="304.8" /><MTPLPRM value="56" /><PAPRM value="392" /></Coverage><Coverage><VERSV value="08d6656f-26d2-11ee-85b2-12a908982d0d" /><LPPRM value="510" /><MAPRM value="95" /><MODPRM value="304.8" /><MTPLPRM value="56" /><PAPRM value="392" /></Coverage><Coverage><VERSV value="08d66570-26d2-11ee-85b2-12a908982d0d" /><LPPRM value="510" /><MAPRM value="95" /><MODPRM value="304.8" /><MTPLPRM value="56" /><PAPRM value="392" /></Coverage><Coverage><VERSV value="08d68c81-26d2-11ee-85b2-12a908982d0d" /><LPPRM value="510" /><MAPRM value="95" /><MODPRM value="304.8" /><MTPLPRM value="56" /><PAPRM value="392" /></Coverage></Coverages><Objects><Vehicle><VehicleID value="df0933fe-408a-11ed-a7cf-0a5801e1e47d" /></Vehicle><Vehicle><VehicleID value="df0933fe-408a-11ed-a7cf-0a5801e1e47d" /></Vehicle><Vehicle><VehicleID value="df0933fe-408a-11ed-a7cf-0a5801e1e47d" /></Vehicle><Vehicle><VehicleID value="df0933fe-408a-11ed-a7cf-0a5801e1e47d" /></Vehicle><Vehicle><VehicleID value="df0933fe-408a-11ed-a7cf-0a5801e1e47d" /></Vehicle></Objects></Offer></root>',
    },
  ];

  generateDocuments(): Observable<Document[]> {
    // Usamos el operador 'of' de RxJS para convertir los datos mock en un Observable
    return of(this.mockDocuments);
  }

  async downloadDocuments(): Promise<void> {
    const zip = new JSZip();
    const folder = zip.folder('documents');

    this.mockDocuments.forEach((doc, i) => {
      folder.file(`request${i + 1}.xml`, doc.request);
      folder.file(`response${i + 1}.xml`, doc.response);
    });

    const content = await zip.generateAsync({ type: 'blob' });
    FileSaver.saveAs(content, 'documents.zip');
  }
}

// necesito adaptar esto para que genere dos documentos xml ( uno para request y otro para response ) y con ellos genere un fichero .zip para poder descargarlo desde el navegador?
